---
title: "Parameter Estimation for Drake Enzyme Data"
output: html_document
runtime: shiny
---

1. [Plots of raw data](#raw)
2. [Gamma distributions](#gamma)

```{r setup, echo=FALSE,message=FALSE,result='hide'}
require(shiny)
library(rjags)
library(R2WinBUGS)
library(rbugs)
library(drc)
library(knitr)

setwd("~/Dropbox/BU2017/CH3/parameterest")
drake=read.csv(file="drake2013_trimmed.csv")
drake=na.omit(drake)
drakeRx=drake[-drake$activity<0,]

AP=drake[drake$substrate=="AP ",]#802 rows
AP=AP[-AP$activity<0,]
BG=drake[drake$substrate=="BG ",] #810 rows
BG=BG[-BG$activity<0,]
CBH=drake[drake$substrate=="CBH",] #803 rows
CBH=CBH[-CBH$activity<0,]
NAG=drake[drake$substrate=="NAG",] #810 rows 
NAG=NAG[-NAG$activity<0,]

APHEM=drake[drake$substrate=="AP "& drake$species=="TSCA",]
APHEM=APHEM[-APHEM$activity<0,]
APASH=drake[drake$substrate=="AP "& drake$species=="FRAM",]
APASH=APASH[-APASH$activity<0,]
APOAK=drake[drake$substrate=="AP "& drake$species=="QURU",]
APOAK=APOAK[-APOAK$activity<0,]

BGASH=drake[drake$substrate=="BG "& drake$species=="FRAM",]
BGASH=BGASH[-BGASH$activity<0,]
BGHEM=drake[drake$substrate=="BG "& drake$species=="TSCA",]
BGHEM=BGHEM[-BGHEM$activity<0,]
BGOAK=drake[drake$substrate=="BG "& drake$species=="QURU",]
BGOAK=BGOAK[-BGOAK$activity<0,]

CBHHEM=drake[drake$substrate=="CBH"& drake$species=="TSCA",]
CBHHEM=CBHHEM[-CBHHEM$activity<0,]
CBHASH=drake[drake$substrate=="CBH"& drake$species=="FRAM",]
CBHASH=CBHASH[-CBHASH$activity<0,]
CBHOAK=drake[drake$substrate=="CBH"& drake$species=="QURU",]
CBHOAK=CBHOAK[-CBHOAK$activity<0,]

NAGHEM=drake[drake$substrate=="NAG"& drake$species=="TSCA",]
NAGHEM=NAGHEM[-NAGHEM$activity<0,]
NAGASH=drake[drake$substrate=="NAG"& drake$species=="FRAM",]
NAGASH=NAGASH[-NAGASH$activity<0,]
NAGOAK=drake[drake$substrate=="NAG"& drake$species=="QURU",]
NAGOAK=NAGOAK[-NAGOAK$activity<0,]
#Vm for AP expected to be close to 3 and kM close to 100
#hist(rgamma(n=100000,shape=0.09,rate=0.10))
subs=c(0:1000)
```

#RAW DATA PLOTS <a id="raw"></a>
Data from Drake et al. 2013 includes the activities of the four enzymes: acid phosphatase (AP), b-1,4-glucosidase (BG), b-N-acetylglucosaminidase (NAG) and cellobiohydrolase (CBH) at three stands dominated by Eastern Hemlock (TsCa), Red Oak (QuRu), or White Ash (FrAm) measured across multiple dates.

```{r, echo=FALSE}
shinyApp(
  ui=fluidPage(
  selectInput("Enzyme",label = "ENZYME",choices=levels(drake$substrate)),
  plotOutput("kinetics")
  ),
  server=function(input,output) {
output$kinetics<-renderPlot({
  plot(drake[drake$substrate==input$Enzyme,3],drake[drake$substrate==input$Enzyme,4],col=drake$species,xlab="Substrate Concentration (uM)",ylab="Activity (umol g-1 hr-1)")
  legend("topleft",legend=c(levels(drake$species)),col=c(1,2,3),pch=16)
})
  },
options = list(height = 500)
)
```

#GAMMA DISTRIBUTION <a id="gamma"></a>
When fitting michaelis-menten curves to these data, we used priors specified by the gamma distribution. This distribution can be paramterized by the shape and rate parameters. The mean of the distribution is equal to the shape/rate, while the variance is equal to shape/rate^2. (The scale parameter used by default in R is the inverse of the rate. JAGS uses the rate parameter and not scale.) We used the following weakly informative priors in this analysis: Vm ~ dgamma(2,0.5); Km ~ dgamma(6,0.04); shape ~ dgamma(0.1,0.1).

```{r, echo=FALSE}
require(shiny)
shinyApp(
  ui=fluidPage(
    fluidRow(
      column(2,numericInput("shapeinput",label = "SHAPE",2,min=-100,max=100)),
      column(2,numericInput("rateinput",label = "RATE",0.5,min=-100,max=100)),
      column(2,numericInput("XAXIS",label = "X AXIS",10)),
      column(2,numericInput("YAXIS",label = "Y AXIS",0.5)),
      plotOutput("gammadist")
  )),
  server=function(input,output) {
output$gammadist<-renderPlot({
  x=rgamma(500,shape=input$shapeinput,rate=input$rateinput)
  curve(dgamma(x,shape=input$shapeinput,rate=input$rateinput), col='blue',xlim=c(-1,input$XAXIS),ylim=c(0,input$YAXIS),ylab=NA,xlab=NA)
})
  },
options = list(height = 500)
)
```